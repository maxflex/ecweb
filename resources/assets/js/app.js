(function(){var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};angular.module("App",["ngResource","angular-ladda","angularFileUpload","angular-toArrayFilter","thatisuday.ng-image-gallery","ngSanitize"]).config(["ngImageGalleryOptsProvider",function(ngImageGalleryOptsProvider){return ngImageGalleryOptsProvider.setOpts({bubbles:!1,bubbleSize:100})}]).config(["$compileProvider",function($compileProvider){return $compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension|sip):/)}]).config(function(laddaProvider){return laddaProvider.setOption({spinnerColor:"#83b060"})}).filter("cut",function(){return function(value,wordwise,max,tail){var lastspace;return null==tail&&(tail=""),value?(max=parseInt(max,10))?value.length<=max?value:(value=value.substr(0,max),wordwise&&(lastspace=value.lastIndexOf(" "),lastspace!==-1&&("."!==value.charAt(lastspace-1)&&","!==value.charAt(lastspace-1)||(lastspace-=1),value=value.substr(0,lastspace))),value+tail):value:""}}).filter("hideZero",function(){return function(item){return item>0?item:null}}).run(function($rootScope,$q,StreamService){return $rootScope.streamLink=streamLink,$rootScope.StreamService=StreamService,$rootScope.dataLoaded=$q.defer(),$rootScope.frontendStop=function(rebind_masks){if(null==rebind_masks&&(rebind_masks=!0),$rootScope.frontend_loading=!1,$rootScope.dataLoaded.resolve(!0),rebind_masks)return rebindMasks()},$rootScope.range=function(min,max,step){var i,input;for(step=step||1,input=[],i=min;i<=max;)input.push(i),i+=step;return input},$rootScope.toggleEnum=function(ngModel,status,ngEnum,skip_values,allowed_user_ids,recursion){var ref,ref1,ref2,status_id,statuses;if(null==skip_values&&(skip_values=[]),null==allowed_user_ids&&(allowed_user_ids=[]),null==recursion&&(recursion=!1),!(!recursion&&(ref=parseInt(ngModel[status]),indexOf.call(skip_values,ref)>=0)&&(ref1=$rootScope.$$childHead.user.id,indexOf.call(allowed_user_ids,ref1)<0)))return statuses=Object.keys(ngEnum),status_id=statuses.indexOf(ngModel[status].toString()),status_id++,status_id>statuses.length-1&&(status_id=0),ngModel[status]=statuses[status_id],indexOf.call(skip_values,status_id)>=0&&(ref2=$rootScope.$$childHead.user.id,indexOf.call(allowed_user_ids,ref2)<0)?$rootScope.toggleEnum(ngModel,status,ngEnum,skip_values,allowed_user_ids,!0):void 0},$rootScope.toggleEnumServer=function(ngModel,status,ngEnum,Resource){var status_id,statuses,update_data;return statuses=Object.keys(ngEnum),status_id=statuses.indexOf(ngModel[status].toString()),status_id++,status_id>statuses.length-1&&(status_id=0),update_data={id:ngModel.id},update_data[status]=status_id,Resource.update(update_data,function(){return ngModel[status]=statuses[status_id]})},$rootScope.formatDateTime=function(date){return moment(date).format("DD.MM.YY в HH:mm")},$rootScope.formatDate=function(date,full_year){return null==full_year&&(full_year=!1),date?moment(date).format("DD.MM.YY"+(full_year?"YY":"")):""},$rootScope.formatDateFull=function(date){return moment(date).format("D MMMM YYYY")},$rootScope.formatDateCustom=function(date,format){return moment(date).format(format)},$rootScope.dialog=function(id){$("#"+id).modal("show")},$rootScope.closeDialog=function(id){$("#"+id).modal("hide")},$rootScope.onEnter=function(event,fun,prevent_default){if(null==prevent_default&&(prevent_default=!0),prevent_default&&event.preventDefault(),13===event.keyCode)return fun()},$rootScope.ajaxStart=function(){return ajaxStart(),$rootScope.saving=!0},$rootScope.ajaxEnd=function(){return ajaxEnd(),$rootScope.saving=!1},$rootScope.findById=function(object,id){return _.findWhere(object,{id:parseInt(id)})},$rootScope.total=function(array,prop,prop2){var sum;return null==prop2&&(prop2=!1),sum=0,$.each(array,function(index,value){var v;return v=value[prop],prop2&&(v=v[prop2]),sum+=v}),sum},$rootScope.yearsPassed=function(year){return moment().format("YYYY")-year},$rootScope.deny=function(ngModel,prop){return ngModel[prop]=+!ngModel[prop]},$rootScope.closestMetro=function(markers){var closest_metro;return closest_metro=markers[0].metros[0],markers.forEach(function(marker){return marker.metros.forEach(function(metro){if(metro.minutes<closest_metro.minutes)return closest_metro=metro})}),closest_metro.station.title},$rootScope.closestMetros=function(markers){var closest_metros;return closest_metros=[],markers.forEach(function(marker,index){return closest_metros[index]=marker.metros[0],marker.metros.forEach(function(metro){if(metro.minutes<closest_metros[index].minutes)return closest_metros[index]=metro})}),closest_metros},$rootScope.photoUrl=function(tutor){return tutor&&tutor.photo_exists?"https://lk.ege-repetitor.ru/img/tutors/"+tutor.id+"."+tutor.photo_extension:"https://lk.ege-repetitor.ru/img/tutors/no-profile-img.gif"},$rootScope.fullName=function(tutor){return tutor.last_name+" "+tutor.first_name+" "+tutor.middle_name},$rootScope.objectLength=function(obj){return Object.keys(obj).length},$rootScope.shortenGrades=function(tutor){var a,combo_end,combo_start,grade_string,grades,i,j,last_grade,limit,pairs;if(tutor.grades.length<=3)return grades=_.clone(tutor.grades),grades.length>1&&(last_grade=grades.pop()),grade_string=grades.join(", "),last_grade&&(grade_string+=" и "+last_grade),grade_string+(last_grade?" классы":" класс");if(a=_.clone(tutor.grades),!(a.length<1)){for(limit=a.length-1,combo_end=-1,pairs=[],i=0;i<=limit;)if(combo_start=parseInt(a[i]),combo_start>11)i++,combo_end=-1,pairs.push(combo_start);else if(combo_start<=combo_end)i++;else{for(j=i;j<=limit&&(combo_end=parseInt(a[j]),!(combo_end>=11))&&!(parseInt(a[j+1])-combo_end>1);)j++;combo_start!==combo_end?pairs.push(combo_start+"–"+combo_end+" классы"):pairs.push(combo_start+" класс"),i++}return pairs.join(", ")}},$rootScope.countObj=function(obj){return Object.keys(obj).length},$rootScope.formatBytes=function(bytes){return bytes<1024?bytes+" Bytes":bytes<1048576?(bytes/1024).toFixed(1)+" KB":bytes<1073741824?(bytes/1048576).toFixed(1)+" MB":(bytes/1073741824).toFixed(1)+" GB"}})}).call(this),function(){}.call(this),function(){angular.module("App").controller("Cv",function($scope,$timeout,$http,Subjects,Cv,StreamService){var streamString;return bindArguments($scope,arguments),$timeout(function(){return $scope.cv={},$scope.sent=!1}),$scope.send=function(){return $scope.sending=!0,$scope.errors={},Cv.save($scope.cv,function(){return StreamService.run("tutor_cv",streamString()),$scope.sending=!1,$scope.sent=!0,$("body").animate({scrollTop:$(".header").offset().top}),dataLayerPush({event:"cv"})},function(response){return $scope.sending=!1,angular.forEach(response.data,function(errors,field){var input,selector;if($scope.errors[field]=errors,selector="[ng-model$='"+field+"']",$("html,body").animate({scrollTop:$("input"+selector+", textarea"+selector).first().offset().top},0),input=$("input"+selector+", textarea"+selector),input.focus(),isMobile)return input.notify(errors[0],notify_options)})})},streamString=function(){var stream_string,subj;return stream_string=[],$scope.cv.subjects&&(subj=[],$scope.cv.subjects.forEach(function(subject_id){return subj.push(Subjects.short_eng[subject_id])}),stream_string.push("subjects="+subj.join("+"))),stream_string.join("_")},$scope.isSelected=function(subject_id){return!(!$scope.cv||!$scope.cv.subjects)&&$scope.cv.subjects.indexOf(subject_id)!==-1},$scope.selectSubject=function(subject_id){return $scope.cv.subjects||($scope.cv.subjects=[]),$scope.isSelected(subject_id)?$scope.cv.subjects=_.without($scope.cv.subjects,subject_id):$scope.cv.subjects.push(subject_id)},$scope.selectedSubjectsList=function(){var i,len,ref,ref1,ref2,subject_id,subjects;if(!(null!=(ref=$scope.cv)&&null!=(ref1=ref.subjects)?ref1.length:void 0))return!1;for(subjects=[],ref2=$scope.cv.subjects,i=0,len=ref2.length;i<len;i++)subject_id=ref2[i],subjects.push($scope.Subjects[subject_id].name);return subjects.join(", ")}})}.call(this),function(){angular.module("App").controller("Empty",function($scope,$timeout,$filter,$http,StreamService){var searchReviews;return bindArguments($scope,arguments),$scope.expand_items={},$scope.expandStream=function(action,type){if(type=$filter("cut")(type,!1,20,"..."),$scope.expand_items[type]=!$scope.expand_items[type],$scope.expand_items[type])return StreamService.run(action,type)},$timeout(function(){return $scope.gallery={}}),$scope.initReviews=function(count,grade,subject,exclude_id){return null==exclude_id&&(exclude_id=null),$scope.search={page:1,count:count,grade:grade,subject:subject,exclude_id:exclude_id,ids:[]},$scope.reviews=[],$scope.has_more_pages=!0,searchReviews()},$scope.nextReviewsPage=function(){return StreamService.run("all_reviews","more"),$scope.search.page++,searchReviews()},searchReviews=function(){return $scope.searching_reviews=!0,$http.get("/api/reviews/block?"+$.param($scope.search)).then(function(response){return $scope.searching_reviews=!1,$scope.reviews=$scope.reviews.concat(response.data.reviews),$scope.search.ids=_.pluck($scope.reviews,"id"),$scope.has_more_pages=response.data.has_more_pages})}})}.call(this),function(){angular.module("App").controller("Gallery",function($scope,$timeout,StreamService){return bindArguments($scope,arguments),angular.element(document).ready(function(){return $scope.all_photos=[],_.each($scope.groups,function(group){return $scope.all_photos=$scope.all_photos.concat(group.photo)})}),$scope.openPhoto=function(photo_id){return StreamService.run("photogallery","open_"+photo_id),$scope.gallery.open($scope.getFlatIndex(photo_id))},$scope.getFlatIndex=function(photo_id){return _.findIndex($scope.all_photos,{id:photo_id})}})}.call(this),function(){angular.module("App").constant("REVIEWS_PER_PAGE",5).controller("Landing",function($scope,$timeout,$http,StreamService,Tutor,REVIEWS_PER_PAGE,Subjects){var initTutors,searchReviews,searchTutors;return bindArguments($scope,arguments),$timeout(function(){return initYoutube(),initTutors()}),$scope.initReviews=function(count,grade,subject){return $scope.search_reviews={page:1,count:count,grade:grade,subject:subject,ids:[]},$scope.reviews=[],$scope.has_more_pages=!0,searchReviews()},$scope.nextReviewsPage=function(){return StreamService.run("all_reviews","more"),$scope.search_reviews.page++,searchReviews()},searchReviews=function(){return $scope.searching_reviews=!0,$http.get("/api/reviews/block?"+$.param($scope.search_reviews)).then(function(response){return $scope.searching_reviews=!1,$scope.reviews=$scope.reviews.concat(response.data.reviews),$scope.search_reviews.ids=_.pluck($scope.reviews,"id"),$scope.has_more_pages=response.data.has_more_pages})},initTutors=function(){return $scope.tutors=[],$scope.tutors_page=1,searchTutors()},$scope.tutorReviews=function(tutor,index){return StreamService.run("tutor_reviews",tutor.id),void 0===tutor.all_reviews&&(tutor.all_reviews=Tutor.reviews({id:tutor.id},function(response){return $scope.showMoreReviews(tutor)})),$scope.toggleShow(tutor,"show_reviews","reviews",!1)},$scope.showMoreReviews=function(tutor,index){var from,to;return tutor.reviews_page=tutor.reviews_page?tutor.reviews_page+1:1,from=(tutor.reviews_page-1)*REVIEWS_PER_PAGE,to=from+REVIEWS_PER_PAGE,tutor.displayed_reviews=tutor.all_reviews.slice(0,to)},$scope.reviewsLeft=function(tutor){var reviews_left;if(tutor.all_reviews&&tutor.displayed_reviews)return reviews_left=tutor.all_reviews.length-tutor.displayed_reviews.length,reviews_left>REVIEWS_PER_PAGE?REVIEWS_PER_PAGE:reviews_left},$scope.nextTutorsPage=function(){return StreamService.run("load_more_tutors",10*$scope.tutors_page),$scope.tutors_page++,searchTutors()},searchTutors=function(){return $scope.searching_tutors=!0,Tutor.search({page:$scope.tutors_page,take:4},function(response){return $scope.searching_tutors=!1,$scope.tutors_data=response,$scope.tutors=$scope.tutors.concat(response.data)})},$scope.video=function(tutor){return StreamService.run("tutor_video",tutor.id),player.loadVideoById(tutor.video_link),player.playVideo(),isMobile&&$(".fullscreen-loading-black").css("display","flex"),openModal("video")},$scope.videoDuration=function(tutor){var duration,format;return duration=parseInt(tutor.video_duration),format=duration>=60?"m мин s сек":"s сек",moment.utc(1e3*duration).format(format)},$scope.videoDurationISO=function(tutor){return moment.duration(tutor.video_duration,"seconds").toISOString()},$scope.toggleShow=function(tutor,prop,iteraction_type,index){return null==index&&(index=null),tutor[prop]?$timeout(function(){return tutor[prop]=!1},$scope.mobile?400:0):tutor[prop]=!0}})}.call(this),function(){angular.module("App").controller("Order",function($scope,$timeout,$http,Grades,Subjects,Request,StreamService){var streamString;return bindArguments($scope,arguments),$timeout(function(){return $scope.order={},$scope.popups={}}),$scope.agreement=!0,$scope.filterPopup=function(popup){return $scope.popups[popup]=!0},$scope.select=function(field,value){return $scope.order[field]=value,$scope.popups={}},$scope.request=function(){return $scope.sending=!0,$scope.errors={},Request.save($scope.order,function(){return StreamService.run("client_request",streamString()),dataLayerPush({event:"purchase",ecommerce:{currencyCode:"RUB",purchase:{actionField:{id:googleClientId()},products:[{brand:$scope.order.grade,category:($scope.order.subjects?$scope.order.subjects.sort().join(","):"")+"_"+$scope.order.branch_id,quantity:1}]}}}),$scope.sending=!1,$scope.sent=!0,$("body").animate({scrollTop:$(".header").offset().top})},function(response){return $scope.sending=!1,angular.forEach(response.data,function(errors,field){var input,selector;if($scope.errors[field]=errors,selector="[ng-model$='"+field+"']",$("html,body").animate({scrollTop:$("input"+selector+", textarea"+selector).first().offset().top},0),input=$("input"+selector+", textarea"+selector),input.focus(),isMobile)return input.notify(errors[0],notify_options)}),StreamService.run("client_request_attempt",response.data[Object.keys(response.data)[0]][0])})},streamString=function(){var stream_string,subj;return stream_string=[],$scope.order.grade&&stream_string.push("class="+$scope.order.grade),$scope.order.subjects&&(subj=[],$scope.order.subjects.forEach(function(subject_id){return subj.push(Subjects.short_eng[subject_id])}),stream_string.push("subjects="+subj.join("+"))),$scope.order.branch_id&&stream_string.push("address="+_.find($scope.Branches,{id:parseInt($scope.order.branch_id)}).code),stream_string.join("_")},$scope.isSelected=function(subject_id){return!(!$scope.order||!$scope.order.subjects)&&$scope.order.subjects.indexOf(subject_id)!==-1},$scope.selectSubject=function(subject_id){return $scope.order.subjects||($scope.order.subjects=[]),$scope.isSelected(subject_id)?$scope.order.subjects=_.without($scope.order.subjects,subject_id):$scope.order.subjects.push(subject_id)},$scope.selectedSubjectsList=function(){var i,len,ref,ref1,ref2,subject_id,subjects;if(!(null!=(ref=$scope.order)&&null!=(ref1=ref.subjects)?ref1.length:void 0))return!1;for(subjects=[],ref2=$scope.order.subjects,i=0,len=ref2.length;i<len;i++)subject_id=ref2[i],subjects.push($scope.Subjects[subject_id].name);return subjects.join(", ")}})}.call(this),function(){angular.module("App").controller("Programs",function($scope,$timeout){return $timeout(function(){return $scope.ready=!0},300)})}.call(this),function(){angular.module("App").constant("REVIEWS_PER_PAGE",5).controller("Reviews",function($scope,$timeout,$http,Subjects,StreamService){var search;return bindArguments($scope,arguments),$timeout(function(){return $scope.reviews=[],$scope.page=1,$scope.has_more_pages=!0,search()}),$scope.popup=function(index){return $scope.show_review=index},$scope.nextPage=function(){return StreamService.run("all_reviews","more"),$scope.page++,search()},search=function(){return $scope.searching=!0,$http.get("/api/reviews?page="+$scope.page).then(function(response){return console.log(response),$scope.searching=!1,$scope.reviews=$scope.reviews.concat(response.data.reviews),$scope.has_more_pages=response.data.has_more_pages})}})}.call(this),function(){angular.module("App").controller("Schedule",function($scope){return bindArguments($scope,arguments),$scope.getDateStringFromMonth=function(month){var year;return year=month>=9?2018:2019,month<10&&(month="0"+month),year+"-"+month+"-01"},$scope.getTitle=function(month){return moment($scope.getDateStringFromMonth(month)).format("MMMM YYYY")},$scope.getDateString=function(date){return moment(date).format("YYYY-MM-DD")},$scope.calendar={},$scope.getCalendar=function(month){var calendar,date,endWeek,startWeek,week;if($scope.calendar.hasOwnProperty(month))return $scope.calendar[month];for(date=$scope.getDateStringFromMonth(month),console.log(date),startWeek=moment(date).startOf("month").week(),endWeek=moment(date).endOf("month").week(),startWeek>endWeek&&(endWeek=startWeek+5),calendar=[],week=startWeek;week<=endWeek;)calendar.push(Array(7).fill(0).map(function(_this){return function(n,i){return moment(date).week(week).startOf("week").clone().add(n+i,"day").toDate()}}(this))),week++;return 9===month&&(calendar=calendar.slice(3,5)),$scope.calendar[month]=calendar,calendar},$scope.outMonth=function(day,month){var date;return date=$scope.getDateStringFromMonth(month),moment(day).format("M")!==moment(date).format("M")}})}.call(this),function(){angular.module("App").controller("Stats",function($scope,$timeout,$http,Subjects,Grades,AvgScores,StreamService){var search;return bindArguments($scope,arguments),$timeout(function(){return $scope.search={page:1,year:"2016"},$scope.data={},$scope.show_review=null,$scope.filter()}),$scope.changeSubject=function(){return StreamService.run("subject_class_stats_set",$scope.search.subject_grade),$scope.search.tutor_id=null,$scope.filter()},$scope.changeTutor=function(){return StreamService.run("tutor_stats_set",$scope.search.tutor_id),$scope.filter()},$scope.changeYear=function(){return StreamService.run("year_stats_set",$scope.search.year),$scope.filter()},$scope.popup=function(index){return $scope.show_review=index},$scope.nextPage=function(){return StreamService.run("load_more_results",50*$scope.search.page),$scope.search.page++,search()},$scope.filter=function(){return $scope.search.page=1,search()},$scope.getScoreLabel=function(){var grade,label,profile,ref,subject_id;return ref=$scope.search.subject_grade.split("-"),subject_id=ref[0],grade=ref[1],profile=ref[2],label=(9===parseInt(grade)?"ОГЭ":"ЕГЭ")+" по "+Subjects.dative[subject_id],1===parseInt(subject_id)&&parseInt(grade)>=10&&(label+=10===parseInt(grade)?" (база)":parseInt(profile)?" (профиль)":" (база)"),label},$scope.getSubjectsGrades=function(){var options;return void 0===$scope.subject_grades&&(options=[{id:"1-11-1",label:"ЕГЭ математика (профиль)"},{id:"1-11-0",label:"ЕГЭ математика (база)"}],[11,10,9].forEach(function(grade){return $.each(Subjects.full,function(subject_id,subject_name){var grade_label,label;if(11!==grade||1!==parseInt(subject_id)){switch(subject_name=subject_name.toLowerCase(),parseInt(grade)){case 11:grade_label="ЕГЭ";break;case 9:grade_label="ОГЭ";break;default:grade_label=grade+" класс"}return label=grade_label+" "+subject_name,10===grade&&1===parseInt(subject_id)&&(label+=" (база)"),options.push({id:subject_id+"-"+grade,label:label})}})}),$scope.subject_grades=options),$scope.subject_grades},search=function(){return $scope.searching=!0,$http.get("/api/stats?"+$.param($scope.search)).then(function(response){if(console.log(response),$scope.searching=!1,1===$scope.search.page?$scope.data=response.data:($scope.data.has_more_pages=response.data.has_more_pages,$scope.data.reviews=$scope.data.reviews.concat(response.data.reviews)),$timeout(function(){return $(".custom-select").trigger("render")}),isMobile)return $timeout(function(){return bindToggle()})})}})}.call(this),function(){angular.module("App").constant("REVIEWS_PER_PAGE",5).controller("Tutors",function($scope,$timeout,$http,Tutor,REVIEWS_PER_PAGE,Subjects,StreamService){var filter,filter_used,search,search_count;return bindArguments($scope,arguments),initYoutube(),$scope.popups={},$scope.filterPopup=function(popup){return $scope.popups[popup]=!0},search_count=0,$scope.profilePage=function(){return RegExp(/^\/tutors\/[\d]+$/).test(window.location.pathname)},$timeout(function(){if($scope.search={},!$scope.profilePage())return $scope.filter()}),$scope.selectSubject=function(id){return $scope.search.subject_id=id,$scope.popups={},$scope.subjectChanged()},$scope.reviews=function(tutor,index){return StreamService.run("tutor_reviews",tutor.id),void 0===tutor.all_reviews&&(tutor.all_reviews=Tutor.reviews({id:tutor.id},function(response){return $scope.showMoreReviews(tutor)})),$scope.toggleShow(tutor,"show_reviews","reviews",!1)},$scope.showMoreReviews=function(tutor,index){var from,to;return tutor.reviews_page=tutor.reviews_page?tutor.reviews_page+1:1,from=(tutor.reviews_page-1)*REVIEWS_PER_PAGE,to=from+REVIEWS_PER_PAGE,tutor.displayed_reviews=tutor.all_reviews.slice(0,to)},$scope.reviewsLeft=function(tutor){var reviews_left;if(tutor.all_reviews&&tutor.displayed_reviews)return reviews_left=tutor.all_reviews.length-tutor.displayed_reviews.length,reviews_left>REVIEWS_PER_PAGE?REVIEWS_PER_PAGE:reviews_left},$scope.subjectChanged=function(){return StreamService.run("choose_tutor_subject",Subjects.short_eng[$scope.search.subject_id]),$scope.filter()},filter_used=!1,$scope.filter=function(){return $scope.tutors=[],$scope.page=1,filter_used?filter():(filter(),filter_used=!0)},filter=function(){return search()},$scope.nextPage=function(){return StreamService.run("load_more_tutors",10*$scope.page),$scope.page++,search()},search=function(){return $scope.searching=!0,Tutor.search({filter_used:filter_used,page:$scope.page,search:$scope.search},function(response){return search_count++,$scope.searching=!1,$scope.data=response,$scope.tutors=$scope.tutors.concat(response.data)})},$scope.video=function(tutor){return StreamService.run("tutor_video",tutor.id),player.loadVideoById(tutor.video_link),player.playVideo(),isMobile&&$(".fullscreen-loading-black").css("display","flex"),openModal("video")},$scope.videoDuration=function(tutor){var duration,format;return duration=parseInt(tutor.video_duration),format=duration>=60?"m мин s сек":"s сек",moment.utc(1e3*duration).format(format)},$scope.videoDurationISO=function(tutor){return moment.duration(tutor.video_duration,"seconds").toISOString()},$scope.toggleShow=function(tutor,prop,iteraction_type,index){return null==index&&(index=null),tutor[prop]?$timeout(function(){return tutor[prop]=!1},$scope.mobile?400:0):tutor[prop]=!0},$scope.popup=function(id,tutor,fn,index){if(null==tutor&&(tutor=null),null==fn&&(fn=null),null==index&&(index=null),openModal(id),null!==tutor&&($scope.popup_tutor=tutor),null!==fn)return $timeout(function(){return $scope[fn](tutor,index)})}})}.call(this),function(){angular.module("App").value("AvgScores",{"1-11-1":46.3,"2-11":51.2,"3-11":56.1,"4-11":52.8,"5-11":53,"6-11":65.8,"7-11":56,"8-11":53.3,"9-11":48.1,"10-11":64.2,"11-11":53}).value("Grades",{9:"9 класс",10:"10 класс",11:"11 класс"}).value("Subjects",{all:{1:"математика",2:"физика",3:"химия",4:"биология",5:"информатика",6:"русский",7:"литература",8:"обществознание",9:"история",10:"английский",11:"география"},full:{1:"Математика",2:"Физика",3:"Химия",4:"Биология",5:"Информатика",6:"Русский язык",7:"Литература",8:"Обществознание",9:"История",10:"Английский язык",11:"География"},dative:{1:"математике",2:"физике",3:"химии",4:"биологии",5:"информатике",6:"русскому языку",7:"литературе",8:"обществознанию",9:"истории",10:"английскому языку",11:"географии"},"short":["М","Ф","Р","Л","А","Ис","О","Х","Б","Ин","Г"],three_letters:{1:"МАТ",2:"ФИЗ",3:"ХИМ",4:"БИО",5:"ИНФ",6:"РУС",7:"ЛИТ",8:"ОБЩ",9:"ИСТ",10:"АНГ",11:"ГЕО"},short_eng:{1:"math",2:"phys",3:"chem",4:"bio",5:"inf",6:"rus",7:"lit",8:"soc",9:"his",10:"eng",11:"geo"}})}.call(this),function(){angular.module("App").directive("academic",function(){return{restrict:"E",template:"{{ year }}–{{ +(year) + 1 }}",scope:{year:"="}}})}.call(this),function(){angular.module("App").directive("digitsOnly",function(){return{restrics:"A",require:"ngModel",link:function($scope,$element,$attr,$ctrl){var filter,ref;return filter=function(value){var new_value;if(value)return new_value=value.replace(/[^0-9]/g,""),new_value!==value&&($ctrl.$setViewValue(new_value),$ctrl.$render()),value},null!=(ref=$ctrl.$parsers)?ref.push(filter):void 0}}})}.call(this),function(){angular.module("App").directive("errors",function(){return{restrict:"E",templateUrl:"/directives/errors",scope:{model:"@"},controller:function($scope,$element,$attrs){return $scope.only_first=$attrs.hasOwnProperty("onlyFirst"),$scope.getErrors=function(){var errors;if(void 0!==$scope.$parent.errors&&(errors=$scope.$parent.errors[$scope.model]))return $scope.only_first?[errors[0]]:errors}}}})}.call(this),function(){}.call(this),function(){angular.module("App").directive("ngMark",function(){return{restrict:"A",scope:{word:"@"},controller:function($scope,$element,$attrs,$timeout){return $timeout(function(){return $($element).mark($scope.word,{separateWordSearch:!0,accuracy:{value:"exactly",limiters:["!","@","#","&","*","(",")","-","–","—","+","=","[","]","{","}","|",":",";","'",'"',"‘","’","“","”",",",".","<",">","/","?"]}})})}}})}.call(this),function(){angular.module("App").directive("ngPhone",function(){return{restrict:"A",link:function($scope,element){return $(element).inputmask("+7 (999) 999-99-99",{autoclear:!1,showMaskOnHover:!1})}}})}.call(this),function(){angular.module("App").directive("plural",function(){return{restrict:"E",scope:{count:"=",type:"@",noneText:"@"},templateUrl:"/directives/plural",controller:function($scope,$element,$attrs,$timeout){return $scope.textOnly=$attrs.hasOwnProperty("textOnly"),$scope.hideZero=$attrs.hasOwnProperty("hideZero"),$scope.when={age:["год","года","лет"],student:["ученик","ученика","учеников"],minute:["минуту","минуты","минут"],hour:["час","часа","часов"],day:["день","дня","дней"],rubbles:["рубль","рубля","рублей"],client:["клиент","клиента","клиентов"],mark:["оценки","оценок","оценок"],review:["отзыв","отзыва","отзывов"],request:["заявка","заявки","заявок"],profile:["анкета","анкеты","анкет"],address:["адрес","адреса","адресов"],person:["человек","человека","человек"],ton:["тонна","тонны","тонн"],yacht:["яхта","яхты","яхт"],photo:["фото","фотографии","фотографий"]}}}})}.call(this),function(){angular.module("App").directive("programItem",function(){return{templateUrl:"/directives/program",scope:{item:"=",level:"=?",levelstring:"="},controller:function($timeout,$element,$scope){return $scope.level||($scope.level=0),$scope.getChildLevelString=function(child_index){var str;return str=$scope.levelstring?$scope.levelstring:"",str+(child_index+1)+"."}}}})}.call(this),function(){}.call(this),function(){var apiPath,countable,updatable;angular.module("App").factory("Tutor",function($resource){return $resource(apiPath("tutors"),{id:"@id",type:"@type"},{search:{method:"POST",url:apiPath("tutors","search")},reviews:{method:"GET",isArray:!0,url:apiPath("reviews")}})}).factory("Request",function($resource){return $resource(apiPath("requests"),{id:"@id"},updatable())}).factory("Cv",function($resource){return $resource(apiPath("cv"),{id:"@id"},updatable())}).factory("Stream",function($resource){return $resource(apiPath("stream"),{id:"@id"})}),apiPath=function(entity,additional){return null==additional&&(additional=""),"/api/"+entity+"/"+(additional?additional+"/":"")+":id"},updatable=function(){return{update:{method:"PUT"}}},countable=function(){return{count:{method:"GET"}}}}.call(this),function(){angular.module("App").service("PhoneService",function(){var isFull;return this.checkForm=function(element){var phone_element,phone_number;return phone_element=$(element).find(".phone-field"),isFull(phone_element.val())?(phone_number=phone_element.val().match(/\d/g).join(""),"4"===phone_number[1]||"9"===phone_number[1]||(phone_element.focus().notify("номер должен начинаться с 9 или 4",notify_options),!1)):(phone_element.focus().notify("номер телефона не заполнен полностью",notify_options),!1)},isFull=function(number){return void 0!==number&&""!==number&&!number.match(/_/)},this})}.call(this),function(){angular.module("App").service("StreamService",function($http,$timeout,Stream){return this.identifySource=function(tutor){return null==tutor&&(tutor=void 0),void 0!==tutor&&tutor.is_similar?"similar":RegExp(/^\/[\d]+$/).test(window.location.pathname)?"tutor":"/request"===window.location.pathname?"help":"/"===window.location.pathname?"main":"serp"},this.generateEventString=function(params){var parts,search;return search=$.cookie("search"),void 0!==search&&$.each(JSON.parse(search),function(key,value){return params[key]=value}),parts=[],$.each(params,function(key,value){var where;switch(key){case"sort":switch(parseInt(value)){case 2:value="maxprice";break;case 3:value="minprice";break;case 4:value="rating";break;case 5:value="bymetro";break;default:value="pop"}break;case"place":switch(parseInt(params.place)){case 1:where="tutor";break;case 2:where="client";break;default:where="any"}}if("action"!==key&&"type"!==key&&"google_id"!==key&&"yandex_id"!==key&&"id"!==key&&"hidden_filter"!==key&&value)return parts.push(key+"="+value)}),parts.join("_")},this.updateCookie=function(params){return void 0===this.cookie&&(this.cookie={}),$.each(params,function(_this){return function(key,value){return _this.cookie[key]=value}}(this)),$.cookie("stream",JSON.stringify(this.cookie),{expires:365,path:"/"})},this.initCookie=function(){return void 0!==$.cookie("stream")?this.cookie=JSON.parse($.cookie("stream")):this.updateCookie({step:0,search:0})},this.run=function(action,type,additional){return null==additional&&(additional={}),void 0===this.cookie&&this.initCookie(),this.initialized?this._run(action,type,additional):$timeout(function(_this){return function(){return _this._run(action,type,additional)}}(this),1e3)},this._run=function(action,type,additional){var params;return null==additional&&(additional={}),this.updateCookie({step:this.cookie.step+1}),params={action:action,type:type,step:this.cookie.step,google_id:googleClientId(),yandex_id:yaCounter8061652.getClientID(),mobile:"undefined"==typeof isMobile?"0":"1"},$.each(additional,function(_this){return function(key,value){return params[key]=value}}(this)),"page"!==action&&dataLayerPush({event:"configuration",eventCategory:action,eventAction:type}),Stream.save(params).$promise},this})}.call(this);